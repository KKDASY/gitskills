

# 前言：

根据被测对象的电气特性与功能差异，**板测治具可系统划分为四大类：脊髓板治具、驱动板治具、含磁编排线治具及不含磁编排线治具**。测试体系采用主-陪-被测三元架构实现协同测试功能，其中主测板统一搭载STM32G431CBU6作为核心控制器，陪测板则选用STM32G431CBY3TR单片机（区分黑色/绿色封装版本）。

本文将基于**测试逻辑架构**和**微控制器功能**两个维度，对板测系统的运行机制进行技术解析，并在附录中收录板测相关的参考文档索引：

# 一、测试逻辑架构

### 1. 脊髓板治具

（1）测试框架主体及固件配置

脊髓板测试系统**由主测板、被测脊髓板及5个绿色封装陪测板**组成。在该测试框架中，脊髓板与陪测板无需专用测试固件，直接烧录标准产品固件即可满足功能验证需求。RS485波特率配置上，**主测板和脊髓板统一为921600，脊髓板和5个驱动板间提升为4M**，以满足实时性要求更高的数据交互需求。

| **测试框架主体** | **烧写固件**                                         |
| ---------------- | ---------------------------------------------------- |
| 主测板           | MainTest_V0.5                                        |
| 被测-脊髓板      | wuji-bootloader-1.1-both   wujihand-sboard-app-2.7.1 |
| 陪测-驱动板      | ----                                                 |

（2）测试流程、现象及说明

板测治具上电后，操作人员首先完成 Bootloader及 产品固件的烧录流程。随后，脊髓板默认进入 Bootloader 模式，待操作人员按下按钮1后，设备切换至产品固件运行状态。进一步触发按钮2后，系统正式启动测试程序，并依据测试结果输出状态指示。最后触发按钮3，系统断电，操作人员取下被测脊髓板。具体流程如下：

| **操作流程**           | **治具现象**                                                 | **说明**                                                     |
| ---------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 开启电源               | 黄灯常亮                                                     | 外设初始化<br />获取拨码开关状态<br />确定被测对象及测试项   |
| 放入待测对象，下拉手柄 | 绿灯闪烁                                                     | TPS26400 启动，驱动板上电                                    |
| 脚本烧录固件           | 绿灯闪烁                                                     | 脚本用于烧写 Bootloader 和测试固件，具体功能见飞书《知识库》 |
| 按下按钮1              | 绿灯闪烁                                                     | 触发脊髓板 BOOTJUMP                                          |
| 按下按钮2              | 开始测试后，黄灯闪烁，<br />**测试合格**，转为绿灯常亮<br />**测试不合格**，转为红灯常亮<br />**10s未接收到测试结果**，转为红灯闪烁 | 主测板通过RS485向脊髓板发送测试指令，脊髓板与5个驱动板通讯，将通讯结果发回给主测板，主测板判断是否合格 |
| 按下按钮3              | 黄灯常亮                                                     | 电源已断开，测试停止                                         |

（3）测试内容及检测标准

| **测试项目**  | **检测内容**                                                 |
| ------------- | ------------------------------------------------------------ |
| RS485通信测试 | 检测标准：主测板接收来自脊髓板的报文，依次检测帧头、源ID、目的ID、CRC、协议、控制字、索引、数据内容<br />检测次数：1<br />通过率要求：100% |

### 2. 驱动板治具

（1）测试框架主体及固件配置

驱动板测试系统由**主测板、被测驱动板及陪测板**组成。在该测试框架中，被测板可以是黑色/绿色封装版本，对应两种不同型号的治具。被测板统一是黑色封装。RS485波特率配置上，**主测板、驱动板和陪测板统一为921600**。

| **测试框架主体**              | **烧写固件**                              |
| ----------------------------- | ----------------------------------------- |
| 主测板                        | MainTest_V0.5                             |
| 被测-驱动板（黑色或绿色封装） | wuji-bootloader-1.1-both   JointTest_V0.5 |
| 陪测-驱动板（黑色封装）       | FunctionTest V0.2                         |

（2）测试流程、现象及说明

板测治具上电后，操作人员首先完成 Bootloader及 产品固件的烧录流程。随后，驱动板默认进入 Bootloader 模式，待操作人员按下按钮1后，设备切换至产品固件运行状态。进一步触发按钮2后，系统正式启动测试程序，并依据测试结果输出状态指示。最后触发按钮3后，系统断电，操作人员取下被测驱动板。具体流程如下：

| **操作流程**           | **治具现象**                                                 | **说明**                                                     |
| ---------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 开启电源               | 黄灯常亮                                                     | 外设初始化<br />获取拨码开关状态<br />确定被测对象及测试项   |
| 放入待测对象，下拉手柄 | 绿灯闪烁                                                     | TPS26400启动，驱动板和陪测板上电                             |
| 脚本烧录固件           | 绿灯闪烁                                                     | 脚本用于烧写Bootloader和测试固件，具体功能见飞书《知识库》   |
| 按下按钮1              | 绿灯闪烁                                                     | 触发驱动板BOOTJUMP                                           |
| 按下按钮2              | 开始测试后，黄灯闪烁，<br />**测试合格**，转为绿灯常亮<br />**测试不合格**，转为红灯常亮<br />**10s未接收到测试结果**，转为红灯闪烁 | 主测板通过RS485发送测试指令，驱动板和陪测板执行测试项，执行完毕后驱动板将测试结果返回<br />其中，测试项目包括<br />（1）总线电压测试<br />（2）RS485测试<br />（3）KTH7816测试（SPI）<br />（4）KTH5701测试（I2C）<br />（5）参考电压采样测试<br />（6）相电流采样测试<br />（7）DRV8361状态测试（SPI）<br />（8）DRV8316驱动测试<br /> |
| 按下按钮3              | 黄灯常亮                                                     | 电源已断开，测试停止                                         |

（3）测试内容及检测标准

| **测试项目**           | **检测内容**                                                 |
| ---------------------- | ------------------------------------------------------------ |
| ADC总线电压采样测试    | 检测标准：驱动板读取的电压在12V±1范围内<br />检测次数：1000次<br />通过率要求：95% |
| RS485通信测试          | 检测标准：驱动板发送并接收来自陪测板的报文，依次检测帧头、帧尾、目的ID、CRC<br />检测次数：1<br />通过率要求：100% |
| KTH7816测试（SPI）     | 检测标准：驱动板读取的位置值在0-0xFFFF之间<br />检测次数：1000<br />通过率要求：95% |
| KTH5701测试（I2C）     | 检测标准：驱动板读取的A相值在0-0xFFFF之间<br />检测次数：1000<br />通过率要求：95% |
| ADC参考电压采样测试    | 检测标准：驱动板读取的电压在3.3V±0.5范围内<br />检测次数：1000次<br />通过率要求：95% |
| ADC相电流采样测试      | 检测标准：驱动板读取的三相电流在0V±0.1范围内<br />检测次数：1000次<br />通过率要求：95% |
| DRV8361状态测试（SPI） | 检测标准：驱动板读取的ICSR SR1 SR2寄存器数值均为0<br />检测次数：1<br />通过率要求：100% |
| DRV8361驱动测试（ADC） | 检测标准：驱动板读取的U相和W相数据在-0.5到0.5之间<br />检测次数：U相和W相各4000次<br />通过率要求：U相和W相至少3250次通过 |

### 3. 带磁编排线治具

（1）测试框架主体及固件配置

带磁编排线的测试系统由**主测板、被测排线及陪测板**组成。在该测试框架中，陪测板可以是黑色/绿色封装，二者烧写固件相同，但RS485通信接口的线序有区别。RS485波特率配置上，**主测板和陪测板统一为4M**，在保证通信可靠性的同时最大化测试效率。

| **测试框架主体**             | **烧写固件**      |
| ---------------------------- | ----------------- |
| 主测板                       | MainTest_V0.5     |
| 陪测-驱动板（黑色/绿色封装） | FunctionTest V0.2 |

（2）测试流程、现象及说明

板测治具上电后，操作人员连续按下按钮1和按钮2，系统正式启动测试程序，并依据测试结果输出状态指示。最后触发按钮3后，系统断电，操作人员取下被测排线。具体流程如下：

| **操作流程**                     | **治具现象**                                                 | **说明**                                                     |
| -------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 开启电源                         | 黄灯常亮                                                     | 外设初始化<br />获取拨码开关状态<br />确定被测对象及测试项   |
| 连通气泵，放入待测对象，下拉手柄 | 绿灯闪烁                                                     | TPS26400启动，陪测板上电<br />KTH5701初始化                  |
| 按下按钮1                        | 绿灯闪烁                                                     | 无                                                           |
| 按下按钮2                        | 开始测试后，黄灯闪烁，<br />**测试合格**，转为绿灯常亮<br />**测试不合格**，转为红灯常亮<br />**10s未接收到测试结果**，转为红灯闪烁 | 主测板通过SPI和RS485分别向KTH7816（在被测排线上）和陪测板发送测试指令，根据返回结果判断是否合格 |
| 按下按钮3                        | 黄灯常亮                                                     | 电源断开，测试停止                                           |

（3）测试内容及检测标准

| **测试项目**       | **检测内容**                                                 |
| ------------------ | ------------------------------------------------------------ |
| RS485通信测试      | 检测标准：主测板发送并接收来自陪测板的报文，依次检测帧头、帧尾、目的ID、CRC<br />检测次数：1<br />通过率要求：100% |
| KTH5701测试（I2C） | 检测标准：驱动板读取的A相值在0-0xFFFF之间<br />检测次数：1000<br />通过率要求：95% |

### 4. 不带磁编排线治具

（1）测试框架主体及固件配置

不带磁编排线的测试系统由**主测板、被测排线及陪测板**组成。在该测试框架中，陪测板可以是黑色/绿色封装，二者烧写固件相同，但RS485通信接口的线序有区别。RS485波特率配置上，**主测板和陪测板统一为4M**，在保证通信可靠性的同时最大化测试效率。

| **测试框架主体**             | **烧写固件**      |
| ---------------------------- | ----------------- |
| 主测板                       | MainTest_V0.5     |
| 陪测-驱动板（黑色/绿色封装） | FunctionTest V0.2 |

（2）测试流程、现象及说明

板测治具上电后，操作人员连续按下按钮1和按钮2，系统正式启动测试程序，并依据测试结果输出状态指示。最后触发按钮3后，系统断电，操作人员取下被测排线。具体流程如下：

| **操作流程**                     | **治具现象**                                                 | **说明**                                                   |
| -------------------------------- | ------------------------------------------------------------ | ---------------------------------------------------------- |
| 开启电源                         | 黄灯常亮                                                     | 外设初始化<br />获取拨码开关状态<br />确定被测对象及测试项 |
| 连通气泵，放入待测对象，下拉手柄 | 绿灯闪烁                                                     | TPS26400启动，陪测板上电                                   |
| 按下按钮1                        | 绿灯闪烁                                                     | 无                                                         |
| 按下按钮2                        | 开始测试后，黄灯闪烁，<br />**测试合格**，转为绿灯常亮<br />**测试不合格**，转为红灯常亮<br />**10s未接收到测试结果**，转为红灯闪烁 | 通过RS485向陪测板发送测试指令，根据返回结果判断是否合格    |
| 按下按钮3                        | 黄灯常亮                                                     | 电源断开，测试停止                                         |

（3）测试内容及检测标准

| **测试项目**  | **检测内容**                                                 |
| ------------- | ------------------------------------------------------------ |
| RS485通信测试 | 检测标准：主测板发送并接收来自陪测板的报文，依次检测帧头、帧尾、源ID、目的ID、CRC<br />检测次数：1<br />通过率要求：100% |

# 二、微控制器功能

### 1. 主测板

芯片类型：STM32G431CBU6

烧录程序：MainTest_V0.4

功能介绍：该主控模块作为测试系统的核心处理单元，主要负责实现治具的智能化控制功能，具体包括：按键触发测试流程、发送标准化测试指令集、通过指示灯实时反馈测试结果数据，从而构建完整的测试控制闭环。

适用范围：脊髓板治具、驱动板治具、带磁编排线治具、不带磁编排线治具

### 2. 陪测板（绿色 黑色）

芯片类型：STM32G431CBY3TR

烧录程序：FunctionTest

功能介绍：该模块作为辅助测试单元，主要功能是实现主测板（或驱动板）的高速RS485通信协议验证，确保系统串行总线的信号完整性和数据传输可靠性。

适用范围：驱动板治具、带磁编排线治具、不带磁编排线治具

### 3. 驱动板（绿色 黑色）

芯片类型：STM32G431CBY3TR

烧录程序：wuji-bootloader-1.1-both   JointTest_V0.5（仅驱动板治具）

功能介绍：在驱动板治具测试架构中作为被测对象，采用多任务并行处理机制，在接收到主测板指令后，同步执行板上模块自检与陪测板通信验证双重测试流程，最终将诊断结果以标准化数据包形式回传至主控单元。在脊髓板治具测试架构中作为脊髓板的陪测，通过高速RS485总线与脊髓板建立实时数据交互通道，严格遵循主测试序列完成协同验证任务

适用范围：驱动板治具、脊髓板治具

### 4. 脊髓板

芯片类型：STM32H743VIH6

烧录程序：wuji-bootloader-1.1-both   wujihand-sboard-app-2.7.1

功能介绍：在脊髓板治具测试架构中作为被测对象，在接收到主测板控制指令后，通过实时数据交换完成链路检测，最终将包含测试结果的标准化数据包回传至主控单元，实现闭环测试验证。

适用范围：脊髓板治具

# 附录：

【1】治具状态记录表https://vvbwj1rjubu.feishu.cn/wiki/YYWRwb78ZiWm8skNFCZcypRbnIe，可查看全部治具近期使用情况、健康状态、软件更新版本、物料编号等；

【2】板测常见问题及解决方案https://vvbwj1rjubu.feishu.cn/wiki/DGWHwdVU9iNjifkcRF2c1LZ7n4e，记录板测和软件升级过程中的常见问题，提供解决思路；

【3】板测框架https://vvbwj1rjubu.feishu.cn/wiki/M0W8wPxU3iToZqkQq36cJWHTnzg，了解板测框架设计的具体细节，包括外设配置、测试对象编号、通讯协议格式等；













